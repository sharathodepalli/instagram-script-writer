# Copilot Context: Instagram Script-Writer

You are GitHub Copilot. This project is fully scaffolded, tested, and Dockerized.

Whenever I open a new file, please:

- Follow the existing style, logging, and error-handling conventions.
- Write code with type hints and docstrings.
- Add or update tests alongside any new feature.
- If something is ambiguous, ask me a clarifying question.

The project root contains a folder called `documents/` with:

- `doc.md` (main development documentation)
- `doc appendix.md` (production concerns and additional setup)
- `including.md` (repository best practices and additional files)

Use these files to understand the functional requirements, architecture, and coding standards for the "Instagram Script-Writer" app.

## Project Overview

**Purpose:** A full-stack Python pipeline that learns your Instagram video-script style and generates fresh, platform-optimized content on demand.

**Tech Stack:** Python 3.10+, OpenAI API, Pinecone (vector DB), LangChain, Streamlit, Docker, GitHub Actions, pytest.

## Your Task

Generate **every** file in this repository exactly as specified in the documentation:

```
instagram-script-writer/
├── .gitignore
├── .env.example
├── .dockerignore
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
├── runtime.txt
├── LICENSE
├── CONTRIBUTING.md
├── CODE_OF_CONDUCT.md
├── CHANGELOG.md
├── .pre-commit-config.yaml
├── tox.ini
├── version.py
├── src/
│   ├── __init__.py
│   ├── config.py
│   ├── ingest.py
│   ├── generator.py
│   ├── polish.py
│   ├── utils.py
│   └── app.py
├── tests/
│   ├── test_ingest.py
│   ├── test_generator.py
│   ├── test_polish.py
│   └── test_utils.py
├── .github/
│   ├── CODEOWNERS
│   └── workflows/
│       └── ci.yml
└── scripts/                # empty placeholder folder for user's .txt scripts
```

## Core Requirements

### Environment Variables (.env.example)

```env
OPENAI_API_KEY=
PINECONE_API_KEY=
PINECONE_ENV=us-west1-gcp
PINECONE_INDEX=ig-scripts
MODEL_FINE_TUNED=
```

### Key Dependencies (requirements.txt)

```
openai>=0.27.0
pinecone-client>=2.2.0
langchain>=0.0.300
streamlit>=1.20.0
python-dotenv>=1.0.0
pytest>=7.0.0
tenacity>=8.0.0
```

### Core Modules

1. **config.py**: Load environment variables using python-dotenv
2. **ingest.py**: Read scripts from `scripts/*.txt`, embed with OpenAI, upsert to Pinecone
3. **generator.py**: Retrieve style examples (top-3) and generate draft with retrieval-augmented generation
4. **polish.py**: Second-pass refinement using GPT-4
5. **utils.py**: QC utilities (caption length ≤125 chars, semantic similarity checks)
6. **app.py**: Streamlit web UI for the pipeline

### Code Standards

- **Type annotations** throughout
- **Docstrings** for all functions and classes
- **Proper logging** using Python logging module
- **Error handling** with retries for API calls using tenacity
- **Test stubs** that mock external API calls (OpenAI, Pinecone)
- **Follow PEP 8** formatting standards

### Docker Setup

- **Dockerfile**: Python 3.10-slim base, install requirements, run Streamlit on port 8501
- **docker-compose.yml**: Map environment variables, mount scripts volume
- **.dockerignore**: Exclude unnecessary files from Docker build

### CI/CD Pipeline

- **GitHub Actions workflow**: lint with flake8, test with pytest, build Docker image
- **Pre-commit hooks**: black formatting, flake8 linting, trailing whitespace fixes
- **CODEOWNERS**: Automatic review requests

### Testing Strategy

- **pytest** with fixtures for mocking API calls
- **Test coverage** for all core functions
- **QC validation** tests for caption length and similarity checks

### Project Structure Guidelines

- **Single source of truth** for version in `version.py`
- **Comprehensive .gitignore** for Python, Docker, and environment files
- **MIT or Apache 2.0 license** with proper headers
- **CONTRIBUTING.md** with code style and PR process
- **CHANGELOG.md** for release history tracking

## System Prompt for Script Generation

```
You are [Your Name]—witty, warm, and concise.
Use conversational language, short paragraphs, rhetorical questions.
Sprinkle in sensory details and end with a friendly CTA.
```

## Script Output Format

Each generated script should include:

- **HOOK**: Attention-grabbing opening
- **BODY**: Main content with conversational tone
- **CTA**: Clear call-to-action
- **CAPTION**: ≤125 characters
- **VISUAL DIRECTIONS**: Scene descriptions
- **HASHTAGS**: 5-7 relevant tags

## Quality Control Requirements

- Caption length validation (≤125 characters)
- Semantic similarity check to prevent duplicates (>0.85 similarity threshold)
- Proper error handling with user-friendly messages
- Retry logic for API failures

## Development Workflow

1. Load environment variables in config.py
2. Ingest historical scripts via ingest.py
3. Generate drafts using retrieval-augmented generation
4. Polish output with second-pass model
5. Apply QC checks before final output
6. Serve via Streamlit web interface

## Important Notes

- **Honor all .env.example variables** and load them via python-dotenv in config.py
- **Follow the code examples** in the documentation exactly
- **Include proper error handling** and logging throughout
- **Mock external API calls** in tests (OpenAI, Pinecone)
- **Use absolute imports** where appropriate
- **Include comprehensive docstrings** for all functions

If you discover anything unclear or missing in the `documents/` references, **ask a clarifying question** before proceeding.

Generate files with production-ready code that follows Python best practices, includes proper error handling, logging, and comprehensive test coverage.
